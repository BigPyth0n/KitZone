# StrategyT4 BackTest & Optimization

## ๐ ูุนุฑู ูพุฑูฺู

**StrategyT4-BackTest-Optimize-4.py** ฺฉ ุงุณฺฉุฑูพุช ูพุงุชูู ุงุณุช ุจุฑุง:

* ุดุจูโุณุงุฒ (ุจฺฉโุชุณุช) ู ุจูููโุณุงุฒ ุงุณุชุฑุงุชฺโูุง ูุนุงููุงุช ุฏุฑ ุจุงุฒุงุฑ ููฺุฑุฒ (Futures) ุตุฑุงูโูุง Binance ู KuCoin.
* ุฐุฎุฑูโุณุงุฒ ูุชุงุฌ ุจูโุตูุฑุช ูพุงฺฏุงูโุฏุงุฏู SQLiteุ ูุงูโูุง JSONุ ุชุตุงูุฑ ูููุฏุงุฑ ู ฺฏุฒุงุฑุดโูุง ฺฏุฑุงูฺฉ.
* ุงุฑุงุฆู ุฑุงุจุท ฺฉุงุฑุจุฑ ุชุญุช ูุจ ุจุง ุงุณุชูุงุฏู ุงุฒ Streamlit ุจุฑุง ุชูุธู ูพุงุฑุงูุชุฑูุง ู ููุงุด ูุชุงุฌ.

**ูุฏู** ุงู ูพุฑูฺู ฺฉูฺฉ ุจู ูุนุงูููโฺฏุฑุงู ู ุชุญููโฺฏุฑุงู ุงุณุช ุชุง ุงุณุชุฑุงุชฺโูุง ุฎูุฏ ุฑุง ุจุง ุฏุงุฏูโูุง ูุงูุน ุดุจูโุณุงุฒุ ุงุฑุฒุงุจ ู ุจููู ฺฉููุฏุ ุจุฏูู ูุงุฒ ุจู ุฏุงูุด ุนูู ุจุฑูุงููโููุณ.

---

## ๐ง ุชูุถุญ ุงุณุชุฑุงุชฺ ูุนุงููุงุช

1. **ููุทู ุงุตู:**

   * ุดูุงุณุง ููุงุท ูพูุช (Pivot) ุจุงูุง (High) ู ูพุงู (Low) ุฏุฑ ูููุฏุงุฑ ฺฉูุฏูโุงุณุชฺฉ.
   * ุชุฑุณู ูุงุญู FTC (Fair Trading Channel) ูพุณ ุงุฒ ูุฑ ูพูุช ุจุฑ ุงุณุงุณ ATRุ ูุณุจุช ูุฏุฑุช ูพูุช ู ุนุฑุถ ฺฉูุฏู.
   * ุจุฑุฑุณ ุดุฑุงุท ุชุซุจุช (Stabilization) ู ุชุฃุฏ (Confirmation) ุฏุฑ ฺฉูุฏูโูุง ุจุนุฏ.
   * ูุฑูุฏ ุจู ูุนุงููู ุฎุฑุฏ (Buy) ุง ูุฑูุด (Sell) ููฺฏุงู ุดฺฉุณุช ูุงุญู FTC ุจุง ูุณุจุช ุฑุณฺฉ:ูพุงุฏุงุด (Risk\:Reward) ูุงุจู ุชูุธู.

2. **ูุฑูุฏ ู ุฎุฑูุฌ:**

   * **ูุฑูุฏ (Entry):**

     * ุงฺฏุฑ ููุช ุงุฒ ุณูู ูุงุญู ุฒูู ุนุจูุฑ ฺฉูุฏุ ูุนุงููู ุฎุฑุฏ ุจุงุฒ ูโุดูุฏ.
     * ุงฺฏุฑ ููุช ุงุฒ ฺฉู ูุงุญู ุนุจูุฑ ฺฉูุฏุ ูุนุงููู ูุฑูุด ุจุงุฒ ูโุดูุฏ.
   * **ุญุฏ ุถุฑุฑ (SL):** ุจุฑ ุงุณุงุณ ุงุฑุชูุงุน ูุงุญู FTC ุชูุธู ูโุดูุฏ.
   * **ุญุฏ ุณูุฏ (TP):** ุจุง ุชูุฌู ุจู ูุณุจุช ุฑุณฺฉโุจูโูพุงุฏุงุด (ูุซูุงู 1:1 ุง 1:2) ููุฏุงุฑุฏู ูโุดูุฏ.
   * **ุจุณุชู ุฎูุฏฺฉุงุฑ:** ูุนุงููุงุช ูพุณ ุงุฒ ุฑุณุฏู ุจู SL ุง TP ุจุณุชู ูโุดููุฏ.

3. **ุดุงุฎุตโูุง ู ุงุจุฒุงุฑ:**

   * ATR (Average True Range) ุจุฑุง ุณูุฌุด ููุณุงู ู ุนุฑุถ ุฒูู.
   * ุจุฑุฑุณ ฺฉูุฏูโูุง ุจุง ูุณุจุช ุจุฏูู ุจู ุจุฏูู ฺฉู (ุจุฑุง ุญุฐู ฺฉูุฏูโูุง ูุงูพุงุฏุงุฑ).

---

## โ๏ธ ูุฑูุฏโูุง (Inputs)

ุฏุฑ ุณุงุฏุจุงุฑ Streamlit ูโุชูุงูุฏ ููุงุฏุฑ ุฒุฑ ุฑุง ุชูุธู ฺฉูุฏ:

| ูพุงุฑุงูุชุฑ                 | ููุน        | ุชูุถุญ                                                     |
| ----------------------- | ---------- | --------------------------------------------------------- |
| `lookback_candles`      | ุนุฏุฏ ุตุญุญ   | ุชุนุฏุงุฏ ฺฉูุฏู ุจุฑุง ุดุฑูุน ุจฺฉโุชุณุช (ุจูโุตูุฑุช ฺฏุฐุดุชู ุชุง ููุทู ูุนู). |
| `leverage`              | ุนุฏุฏ ุงุนุดุงุฑ | ููุฑุฌ ูุนุงููุงุช (ูุซูุงู 10 ุจุฑุง ููุฑุฌ 10x).                 |
| `max_open_trades`       | ุนุฏุฏ ุตุญุญ   | ุญุฏุงฺฉุซุฑ ุชุนุฏุงุฏ ูุนุงููุงุช ููโุฒูุงู ุจุงุฒ.                         |
| `initial_balance`       | ุนุฏุฏ ุงุนุดุงุฑ | ููุฌูุฏ ุงููู ุญุณุงุจ (ุจู ุงุฑุฒ ูพุงู).                          |
| `max_drawdown`          | ุฏุฑุตุฏ       | ุจุดุชุฑู Drawdown ูุฌุงุฒ ุชุง ูพุงุงู ุจฺฉโุชุณุช.                    |
| `stabilization_candles` | ุนุฏุฏ ุตุญุญ   | ุชุนุฏุงุฏ ฺฉูุฏู ุจุฑุง ุจุฑุฑุณ ุชุซุจุช ูพุณ ุงุฒ ูพูุช.                   |
| `confirmation_candles`  | ุนุฏุฏ ุตุญุญ   | ฺฉูุฏูโูุง ุชุฃุฏ ุจุนุฏ ุงุฒ ุชุซุจุช.                              |
| `pivot_threshold`       | ุฏุฑุตุฏ       | ุฏุฑุตุฏ ูุฏุฑุช ูพูุช ุจุฑุง ุงูุชุฎุงุจ ูพูุชโูุง ููู.                  |
| `atr_period`            | ุนุฏุฏ ุตุญุญ   | ุฏูุฑู ูุญุงุณุจู ATR (ูุซูุงู 14 ฺฉูุฏู).                          |
| `min_zone_width`        | ุนุฏุฏ ุงุนุดุงุฑ | ุญุฏุงูู ุนุฑุถ ุฒูู ุจุฑ ุญุณุจ ATR.                                 |
| `select_exchange`       | ฺฏุฒูู      | ุงูุชุฎุงุจ ุตุฑุงู (`binance` ุง `kucoin`).                     |

> **ูฺฉุชู:** ูุฑ ูพุงุฑุงูุชุฑ ฺฉ ุชูุถุญ ฺฉูุชุงู ุฒุฑ ุฎูุฏ ูุฒ ููุงุด ุฏุงุฏู ูโุดูุฏ ุชุง ฺฉุงุฑุจุฑ ูุชูุฌู ููุด ุขู ุจุงุดุฏ.

---

## ๐ ุฎุฑูุฌโูุง (Outputs)

1. **ูพุงฺฏุงูโุฏุงุฏู SQLite (`backtest.db`):**

   * **ุฌุฏุงูู:**

     * `BacktestRuns` (ูุดุฎุตุงุช ูุฑ ุงุฌุฑุง ุจฺฉโุชุณุช)
     * `Trades` (ุงุทูุงุนุงุช ูุฑ ูุนุงููู ุจุงุฒ ุดุฏู)
     * `Settings` (ููุงุฏุฑ ูพุงุฑุงูุชุฑูุง ูุฑูุฏ)
     * `RawData` (ุฏุงุฏูโูุง ููุช ุงููู ุจู ููุฑุงู ATR)

2. **ูุงูโูุง JSON (`results/YYYYMMDD_HHMMSS/`):**

   * ุดุงูู ุขุฑุงูโุง ุงุฒ ูุนุงููุงุช ุจุง ุฌุฒุฆุงุช ฺฉุงูู (ุฒูุงู ูุฑูุฏุ ุฎุฑูุฌุ SLุ TPุ ุญุฌู ู ุบุฑู).

3. **ุชุตุงูุฑ ูุนุงููุงุช (`images/`):**

   * ูุฑ ูุนุงููู ุจูโุตูุฑุช ูููุฏุงุฑ ฺฉูุฏูโุงุณุชฺฉ ุจุง ูุงุญู FTC ู ุฎุทูุท SL/TP ุฐุฎุฑู ูโุดูุฏ.

4. **ฺฏุฒุงุฑุด ุชุนุงูู ุฏุฑ Streamlit:**

   * ูููุฏุงุฑ ุณูุฏ ุชุฌูุน (Equity Curve).
   * ูุณุชูฺฏุฑุงู ุณูุฏ ู ุฒุงู ูุนุงููุงุช.
   * ุฌุฏูู ูุนุงููุงุช ุจุง ูุงุจูุช ููุชุฑ ู ูุฑุชุจโุณุงุฒ.

---

## ๐ ุดุฑุญ ุชูุงุจุน (Functions)

### 1. ูุฏุฑุช ูพุงฺฏุงูโุฏุงุฏู

* **`connect_to_backtest_db(db_file)`**

  * **ูุฑูุฏ:** ูุณุฑ ูุงู SQLite.
  * **ุฎุฑูุฌ:** ุดุก ุงุชุตุงู (`conn`).
  * **ุนููฺฉุฑุฏ:** ุงุชุตุงู ุจู ูุงู ุฏุชุงุจุณ ู ุจุงุฒฺฏุฑุฏุงูุฏู Cursor.

* **`migrate_database(conn)`**

  * **ูุฑูุฏ:** ุดุก ุงุชุตุงู ุฏุชุงุจุณ.
  * **ุนููฺฉุฑุฏ:** ุงุถุงูู ฺฉุฑุฏู ุณุชูู `trade_title` ุจู ุฌุฏูู `Trades` ุฏุฑ ุตูุฑุช ูุจูุฏู.

* **`create_backtest_tables(conn)`**

  * **ูุฑูุฏ:** ุดุก ุงุชุตุงู.
  * **ุนููฺฉุฑุฏ:** ุงุฌุงุฏ ุฌุฏุงูู ุงุตู ุฏุฑ ุฏุชุงุจุณ.

* **`save_backtest_run(conn, settings)`**, **`save_trade(conn, trade)`**, **`save_raw_data(conn, data)`**, **`export_to_json(results, folder)`**

  * **ุนููฺฉุฑุฏ:** ุฐุฎุฑู ูุชุงุฌ ู ุชุจุฏู ุจู JSON.

### 2. ุฏุฑุงูุช ุงุทูุงุนุงุช ููุงุฏูุง

* **`get_futures_symbols(client)`**

  * ูุงฺฉุด ูุณุช ููุงุฏูุง ูุนุงู ููฺุฑุฒ.

* **`get_symbol_info(client, symbol)`**

  * ูุงฺฉุด ูพุงุฑุงูุชุฑูุง ูุนุงููุงุช ูุฑ ููุงุฏ (ูพูพุ ุญุฏุงูู ุญุฌู ู โฆ).

### 3. ุดูุงุณุง ูพูุช ู ูุงุญู FTC

* **`is_not_sharp_candle(candle)`**

  * ุญุฐู ฺฉูุฏูโูุง ุจุง ุจุฏูู ุจุณุงุฑ ูุงุฒฺฉ.

* **`find_high_pivots(df, threshold)`** ู **`find_low_pivots(df, threshold)`**

  * ุดูุงุณุง ููุงุท ูพูุช ุจุฑ ุงุณุงุณ ููุงุณู ุจุง ฺฉูุฏูโูุง ูุฌุงูุฑ.

* **`find_FTC_range(pivot_idx, df, atr_period, ...)`**

  * ูุญุงุณุจู ูุญุฏูุฏู ูุงุญู ูพุณ ุงุฒ ูพูุช ุจุง ุงุณุชูุงุฏู ุงุฒ ATR ู ูพุงุฑุงูุชุฑูุง ููุชุฑ.

### 4. ุฏุฑุงูุช ุฏุงุฏู ู ูุญุงุณุจู ATR

* **`fetch_historical_data(client, symbol, timeframe)`**

  * ูุงฺฉุด OHLCV
  * ูุญุงุณุจู ATR ุจุง ุฏูุฑู ูุดุฎุต
  * ุจุฑฺฏุฑุฏุงูุฏู DataFrame ู ูุฏุช ุฒูุงู ุจฺฉโุชุณุช

### 5. ุจฺฉโุชุณุช ุงุตู

* **`backtest_strategy_t3(settings, client, symbols, timeframes)`**

  * ูุณุชู ุงุตู: ุชฺฉุฑุงุฑ ฺฉูุฏูโูุงุ ุจุฑุฑุณ ุดุฑุงุท SL/TPุ ุดูุงุณุง ูพูุชุ ุชุฑุณู ูุงุญูุ ูุฑูุฏ/ุฎุฑูุฌ ูุนุงููุงุชุ ุจูโุฑูุฒโุฑุณุงู Equity.

### 6. ุชุตูุฑุณุงุฒ ูุนุงููุงุช

* **`save_trade_image(trade, df, folder)`**

  * ุฑุณู ฺฉูุฏูโุงุณุชฺฉ ุจุง Plotly
  * ูุงูุงุช ูุงุญู FTC ู ููุงุท ูุฑูุฏ/ุฎุฑูุฌ

### 7. ุชุญูู ููุดููุฏ ุจุง Avalai

* **`analyze_with_avalai(backtest_results)`**

  * ุงุฑุณุงู ุฏุงุฏูโูุง ุจู ูุฏู LLM
  * ุฏุฑุงูุช ูพุดููุงุฏุงุช ุจูููโุณุงุฒ

---

## ๐ ุณุงุฎุชุงุฑ ุงุฌุฑุง ุจุฑูุงูู

1. **ุจุงุฑฺฏุฐุงุฑ ฺฉุชุงุจุฎุงููโูุง ู CSS**
2. **ุฑุงูโุงูุฏุงุฒ Streamlit** ู ูพฺฉุฑุจูุฏ ุตูุญู
3. **ุงุชุตุงู ู ููุงุฌุฑุช ุฏุชุงุจุณ**
4. **ุฎูุงูุฏู ูพุงุฑุงูุชุฑูุง ุงุฒ ุณุงุฏุจุงุฑ**
5. **ุงูุชุฎุงุจ ุตุฑุงู ู ุณุงุฎุช ฺฉูุงูุช**
6. **ูุงฺฏุฐุงุฑ ูุณุช ููุงุฏูุง ู ุชุงูโูุฑูโูุง**
7. **ูุดุฑุฏู ุฏฺฉูู Run:**

   * ูุงฺฉุด ุฏุงุฏูโูุง ุชุงุฑุฎ
   * ุงุฌุฑุง ุชุงุจุน ุจฺฉโุชุณุช
   * ุฐุฎุฑู ูุชุงุฌ (ุฏุชุงุจุณุ JSONุ ุชุตุงูุฑ)
8. **ููุงุด ูุชุงุฌ ุฏุฑ Streamlit:**

   * ูููุฏุงุฑ ุณูุฏ ุชุฌูุนุ ูุณุชูฺฏุฑุงูุ ุฌุฏูู ูุนุงููุงุช
   * ุฏฺฉูู ุฏุฑุงูุช ูุงู JSON
   * ููุงุด ุชุญูู ููุดููุฏ (ุฏุฑ ุตูุฑุช ูุนุงู ุจูุฏู)

---

## ๐ ุฑุงูููุง ุงุณุชูุงุฏู ุจุฑุง ฺฉุงุฑุจุฑ ููุง

1. **ูพุดโูุงุฒูุง:**

   * Python 3.8+
   * ูุตุจ ฺฉุชุงุจุฎุงููโูุง: `pip install -r requirements.txt`
   * ฺฉูุฏูุง API Binance/KuCoin
2. **ุณุงุฎุชุงุฑ ูุงูโูุง:**

   ```
   /StrategyT4-BackTest-Optimize-4.py
   /css/local.css
   /images/
   /results/
   ```
3. **ุงุฌุฑุง ุจุฑูุงูู:**

   ```bash
   streamlit run StrategyT4-BackTest-Optimize-4.py
   ```
4. **ุชูุธู ูพุงุฑุงูุชุฑูุง:**

   * ุฏุฑ ูพูู ฺฉูุงุฑ (ุณุงุฏุจุงุฑ) ููุงุฏุฑ ูุฑูุฏ ุฑุง ุชูุธู ฺฉูุฏ.
   * ุฏฺฉูู **Run Backtest** ุฑุง ุจุฒูุฏ.
5. **ูุดุงูุฏู ุฎุฑูุฌ:**

   * ฺฏุฒุงุฑุด ฺฏุฑุงูฺฉ ุฏุฑ ุตูุญู ุงุตู
   * ุชุตุงูุฑ ูุนุงููุงุช ุฏุฑ ูพูุดู `images/`
   * ูุงูโูุง JSON ุฏุฑ `results/YYYYMMDD_HHMMSS/`

---

**ูููู ุจุงุดุฏ!**

> ุงู README ุจูโฺฏูููโุง ุทุฑุงุญ ุดุฏู ฺฉู ุญุช ฺฉุงุฑุจุฑ ุจุฏูู ูพุดโุฒููู ูู ูุฒ ุจุชูุงูุฏ ูุฑุงุญู ูุตุจ ู ุงุฌุฑุงุ ููุทู ุงุณุชุฑุงุชฺ ู ฺฏุฒุงุฑุด ูุชุงุฌ ุฑุง ุฏูุจุงู ฺฉูุฏ.
